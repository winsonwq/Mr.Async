<!DOCTYPE html>
<html>
	<head>
		<script type="text/javascript" src="../Mr.Async.js"></script>
		<script type="text/javascript" src="parser.js"></script>
		<script type="text/javascript" src="ExpressionVisitor.js"></script>
		<script type="text/javascript" src="Mr.Recoder.js"></script>
		<script type="text/javascript" src="../Mr.Async.Interpreter.js"></script>
		<script type="text/javascript">
			function d(callback){
				var de = Mr.Deferred();
				setTimeout(function(){
					var result = Math.random();
					if(typeof callback == 'function'){
						callback(result);
					}
					de.resolve(result);
				}, 2000);
				return de;
			}

			eval(Mr.Async.recode(function(){
				var i = 0;
				while(i++ < 5){
					var random = Math.random() * 10;
					console.log("random number " + i + ": " + random);
					if(random > 5){
						console.log("waiting if.");
						$await(d());
						console.log("finish waiting if.");
					}else{
						console.log("waiting else");
						var aa = $await(d());
						console.log(aa);
						console.log("finish else");
					}
					console.log("waiting 2.");
					$await(d());
					console.log("finish waiting 2.");
				}	
			}));
		</script>
	</head>
	<body style="height:1000px;">
		<ul id="output">
			
		</ul>
	</body>
</html>